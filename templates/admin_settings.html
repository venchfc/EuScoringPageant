{% extends "base.html" %}

{% block title %}Admin Settings - Pageant Scoring{% endblock %}

{% block content %}
<div class="mb-4">
    <h2><i class="fa-solid fa-gear me-2"></i>Admin Settings</h2>
    <p class="text-muted">Manage system settings and perform administrative tasks</p>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-pen-to-square me-2"></i>Competition Settings</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Edit Competition Details</h6>
                <p class="card-text text-muted">
                    Customize the competition title that appears on the public homepage, results page, and PDF reports. This allows you to use the system for different types of competitions.
                </p>
                <a href="{{ url_for('competition_settings') }}" class="btn btn-primary">
                    <i class="fa-solid fa-sliders me-2"></i>Manage Competition Settings
                </a>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-window-restore me-2"></i>Competition Portals</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Manage Competition</h6>
                <p class="card-text text-muted">
                    Create competition portals and assign tabulator accounts.
                </p>
                <a href="{{ url_for('manage_competition') }}" class="btn btn-primary">
                    <i class="fa-solid fa-layer-group me-2"></i>Manage Competition
                </a>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-clock-rotate-left me-2"></i>History</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Event History</h6>
                <p class="card-text text-muted">
                    Create history cards for completed competitions and view results.
                </p>
                <a href="{{ url_for('admin_history') }}" class="btn btn-primary">
                    <i class="fa-solid fa-card-clipboard me-2"></i>View History
                </a>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-user-gear me-2"></i>Admin Users</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Manage Admin Accounts</h6>
                <p class="card-text text-muted">
                    Create new admin users, reset passwords, or disable access for former staff.
                </p>
                <a href="{{ url_for('admin_users') }}" class="btn btn-primary">
                    <i class="fa-solid fa-users me-2"></i>Manage Admin Users
                </a>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-trophy me-2"></i>Results Display Settings</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Category Winners Display</h6>
                <p class="card-text text-muted">
                    Toggle whether to display the rank 1 winner of each category in the results page, shown below the final results table.
                </p>
                <form method="POST" action="{{ url_for('toggle_category_winners') }}">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="showCategoryWinners" 
                            {% if show_category_winners %}checked{% endif %}
                            onchange="this.form.submit()">
                        <label class="form-check-label" for="showCategoryWinners">
                            <strong>Show Category Winners</strong>
                            <br><small class="text-muted">Display top contestant from each category</small>
                        </label>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-triangle-exclamation me-2"></i>Reset</h5>
            </div>
            <div class="card-body">
                <h6 class="card-title">Reset Database</h6>
                <p class="card-text text-muted">
                    This action will permanently delete all data including:
                </p>
                <ul class="text-muted mb-3">
                    <li>All categories and criteria</li>
                    <li>All contestants</li>
                    <li>All judges</li>
                    <li>All scores</li>
                    <li>Optional: Admin History (archived events)</li>
                </ul>
                <div class="alert alert-warning">
                    <i class="fa-solid fa-triangle-exclamation me-2"></i><strong>Warning:</strong>  This feature is available in all environments. Use when you need to completely clear all data and start fresh.
                </div>
                <form method="POST" action="{{ url_for('reset_database') }}" onsubmit="return confirm('⚠️ FINAL WARNING ⚠️\n\nThis will DELETE ALL DATA from the database!\n\n• All categories and criteria will be removed\n• All contestants will be removed\n• All judges will be removed\n• All scores will be removed\n\nIf you checked the Reset Admin History box, all archived events will be deleted too.\n\nThis action is PERMANENT and CANNOT be undone!\n\nType YES in your mind and click OK only if you are absolutely certain.');">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="resetHistory" name="reset_history">
                        <label class="form-check-label" for="resetHistory">
                            Reset Admin History (archived events)
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fa-solid fa-trash me-2"></i>Reset Database
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-circle-info me-2"></i>Information</h5>
            </div>
            <div class="card-body">
                <h6>System Information</h6>
                <ul class="list-unstyled">
                    <li><strong>Admin User:</strong> {{ session.get('username', 'N/A') }}</li>
                    
                    <li><strong>Version:</strong> 1.0</li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-shield-halved me-2"></i>Security</h5>
            </div>
            <div class="card-body">
                <p class="small text-muted">
                    This admin area is protected and requires authentication. Only authorized personnel should have access.
                </p>
                <a href="{{ url_for('change_password') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-key me-2"></i>Change Password
                </a>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa-solid fa-clock-rotate-left me-2"></i>Audit Logs</h5>
            </div>
            <div class="card-body">
                <p class="small text-muted">
                    View login attempts, score submissions, and category locks with timestamps.
                </p>
                <a href="{{ url_for('admin_logs') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-list me-2"></i>View Logs
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}
